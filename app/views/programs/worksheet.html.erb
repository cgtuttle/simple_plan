<h2><%=  @title %></h2>
<h4>Plan: <%= @plan.code %></h4>


<table class="worksheet">
  <th>Rep</th>
  <th>Program</th>
  <th>Start</th>
  <th>End</th>
  <th>Deal</th>
  <th>Customer</th>
  <th>Status</th>
  <th>Product</th>
  <th>Activity</th>
  <% @plan.programs.each do |p| %>
    
      <tr>            
        <td><%= p.seller != nil ? p.seller.name : nil %></td>        
        <td><%= p.code != nil ? p.code : nil %></td>
        <td><%= p.start_date != nil ? p.start_date.to_s(:just_date) : nil%></td>
        <td><%= p.end_date != nil ? p.end_date.to_s(:just_date) : nil%></td>
        <td>
          <table class="subtable">
            <% p.deals.each do |d| %>
              <tr class="no-greenbars">
                <td class="f-50"><%= d.id != nil ? d.id : nil %></td>
                <td class="f-100"><%= d.customer != nil ? d.customer.name : nil %></td>
                <td class="f-100"><%= d.status %></td>
                <td>
                  <table class="subtable">
                    <% d.deal_products.each do |dp| %>
                      <tr class="no-greenbars">
                        <td class="f-100"><%= dp.product.code %></td>
                        <td>
                          <table class="subtable">
                            <% dp.deal_activities.each do |da| %>
                              <tr class="no-greenbars">
                                <td class="f-100"><%= da.activity.code %>
                              </tr>
                            <% end %>
                          </table>
                        </td>
                      </tr>
                    <% end %>
                  </table>
                </td>
              </tr>
            <% end %>
          </table>
        </td>  
      </tr>
    
  <% end %>
  
        
</table>