<h2><%=  @title %></h2>
<h4>Plan: <%= @plan.code %></h4>

<table class ="no-greenbars">
  <tr class="row-header">
    <th>Rep</th>
    <th>Customer</th>
    <th>Program</th>
    <th>Program Start</th>
    <th>Program End</th>
    <th>Deal</th>
    <th>Product</th>
    <th>Activity</th>
  </tr>

  <%= form_for @plan do |plan| %>
    <%= plan.fields_for :programs, @programs do |p| %>
      <% if p.object.deals.length > 0 %>
        <%= p.fields_for :deals do |d| %>
          <% if d.object.deal_products.length > 0 %>
            <%= d.fields_for :deal_products do |dp| %>
              <% if dp.object.deal_activities.length > 0 %>
                <%= dp.fields_for :deal_activities do |da| %>
                  <tr class="no-greenbars">                   
                    <%= render "fields", { :p => p, :d => d, :dp => dp, :da => da } %>
                  </tr>
                <% end %>
              <% else %>
                <tr class="no-greenbars"> 
                  <%= render "fields", { :p => p, :d => d, :dp => dp, :da => nil } %>
                </tr>
              <% end %>
            <% end %>
          <% else %>
            <tr class="no-greenbars"> 
              <%= render "fields", { :p => p, :d => d, :dp => nil, :da => nil } %>
            </tr>
          <% end %>
        <% end %>
      <% else %>
        <tr class="no-greenbars"> 
          <%= render "fields", { :p => p, :d => nil, :dp => nil, :da => nil } %>
        </tr>
      <% end %>
    <% end %>
  <% end %>
  
</table>